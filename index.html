<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>TripReady</title>
  <style>
    :root { --bg:#0b0f17; --card:#121a26; --muted:#9fb0c8; --text:#eaf0ff; --line:#23324a; --accent:#7aa7ff; }
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Noto Sans KR,Apple SD Gothic Neo,sans-serif;background:linear-gradient(180deg,#0b0f17,#070a10);color:var(--text)}
    .wrap{max-width:1020px;margin:0 auto;padding:28px 18px 64px}
    .top{display:flex;gap:12px;align-items:flex-start;justify-content:space-between;flex-wrap:wrap}
    .brand{display:flex;flex-direction:column;gap:6px}
    h1{margin:0;font-size:26px;letter-spacing:-0.3px}
    .sub{color:var(--muted);font-size:14px;line-height:1.45}
    .pill{border:1px solid var(--line);color:var(--muted);padding:8px 10px;border-radius:999px;font-size:12px}
    .grid{display:grid;grid-template-columns:1fr;gap:14px;margin-top:18px}
    @media(min-width:900px){.grid{grid-template-columns:1.05fr .95fr}}
    .card{background:rgba(18,26,38,.92);border:1px solid rgba(35,50,74,.85);border-radius:16px;padding:16px;box-shadow:0 10px 30px rgba(0,0,0,.25)}
    .card h2{margin:0 0 12px;font-size:16px;color:#dbe7ff}
    label{display:block;color:var(--muted);font-size:13px;margin-bottom:8px}
    textarea,input,select{width:100%;background:#0c1320;border:1px solid var(--line);color:var(--text);border-radius:12px;padding:12px 12px;font-size:14px;outline:none}
    textarea{min-height:98px;resize:vertical}
    input,select{height:42px}
    .row{display:flex;gap:10px}
    .row>*{flex:1}
    .chips{display:flex;flex-wrap:wrap;gap:8px}
    .chip{padding:9px 10px;border-radius:999px;border:1px solid var(--line);background:#0c1320;color:#cfe0ff;font-size:13px;cursor:pointer}
    .chip[data-on="1"]{border-color:var(--accent);box-shadow:0 0 0 3px rgba(122,167,255,.15)}
    .btn{background:#0c1320;border:1px solid var(--line);color:var(--text);border-radius:12px;padding:10px 12px;font-size:14px;cursor:pointer}
    .btn:hover{border-color:#35507a}
    .btnPrimary{background:linear-gradient(180deg,#2a4c86,#203a69);border-color:#3a5da3}
    .btnPrimary:hover{filter:brightness(1.05)}
    .btnGhost{background:transparent}
    .tiny{font-size:12px;color:var(--muted)}
    .actions{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px;align-items:center}
    .divider{height:1px;background:rgba(35,50,74,.9);margin:14px 0}
    .result{display:flex;flex-direction:column;gap:12px}
    .sectionTitle{display:flex;align-items:center;justify-content:space-between;gap:10px}
    .badge{font-size:12px;color:#cfe0ff;border:1px solid rgba(122,167,255,.35);background:rgba(122,167,255,.08);padding:6px 9px;border-radius:999px}
    .block{background:#0c1320;border:1px solid var(--line);border-radius:14px;padding:12px}
    .block h3{margin:0 0 8px;font-size:13px;color:#dbe7ff;display:flex;align-items:center;justify-content:space-between;gap:10px}
    .block p{margin:0;color:#d6e2ff;line-height:1.55;font-size:14px;white-space:pre-wrap}
    .list{margin:0;padding-left:18px;color:#d6e2ff;line-height:1.55;font-size:14px}
    .cols{display:grid;grid-template-columns:1fr;gap:10px}
    @media(min-width:700px){.cols{grid-template-columns:1fr 1fr}}
    .scoreRow{display:grid;grid-template-columns:repeat(2,1fr);gap:10px}
    @media(min-width:540px){.scoreRow{grid-template-columns:repeat(4,1fr)}}
    .scoreCard{background:#0c1320;border:1px solid var(--line);border-radius:14px;padding:12px}
    .scoreLabel{font-size:12px;color:var(--muted);margin-bottom:6px}
    .scoreVal{font-size:20px;font-weight:700;letter-spacing:-0.4px}
    .warn{color:#ffd6a6}
    .ok{color:#bfe5ff}
    .footer{margin-top:14px;color:var(--muted);font-size:12px;line-height:1.45}
    .hidden{display:none}
    .mono{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="top">
      <div class="brand">
        <h1>TripReady</h1>
        <div class="sub">여행 준비를 대신 정리해드립니다. <b>상황에 맞춘 체크리스트</b>와 <b>출발 전 해야 할 일</b>을 설계해요.</div>
      </div>
      <div class="pill">무료 MVP · 저장/로그인 없음</div>
    </div>

    <div class="grid">
      <div class="card">
        <h2>여행 정보</h2>

        <div class="row">
          <div>
            <label for="destination">1) 여행지</label>
            <input id="destination" placeholder="예) 오사카, 제주도, 방콕" />
          </div>
          <div>
            <label for="tripType">2) 국내/해외</label>
            <select id="tripType">
              <option value="국내">국내</option>
              <option value="해외">해외</option>
            </select>
          </div>
        </div>

        <div class="row" style="margin-top:10px">
          <div>
            <label for="nights">3) 기간</label>
            <input id="nights" placeholder="예) 3박4일" />
          </div>
          <div>
            <label for="startDate">4) 출발 날짜 (선택)</label>
            <input id="startDate" type="date" />
          </div>
        </div>

        <div class="row" style="margin-top:10px">
          <div>
            <label for="people">5) 인원 (선택)</label>
            <input id="people" placeholder="예) 2명" />
          </div>
          <div>
            <label for="season">6) 계절/시기 (선택)</label>
            <input id="season" placeholder="예) 6월(장마), 겨울, 성수기" />
          </div>
        </div>

        <div class="divider"></div>

        <label>7) 교통수단</label>
        <div class="chips" id="transportChips">
          <button class="chip" data-value="비행기">비행기</button>
          <button class="chip" data-value="기차">기차</button>
          <button class="chip" data-value="자차">자차</button>
          <button class="chip" data-value="렌트카">렌트카</button>
          <button class="chip" data-value="버스/기타">버스/기타</button>
        </div>

        <div class="divider"></div>

        <label for="notes">8) 특별 상황/메모 (선택)</label>
        <textarea id="notes" placeholder="예) 아이 동반, 부모님 동행, 비건/알러지, 촬영장비 있음, 새벽 비행, 공항 픽업 필요 등"></textarea>

        <div class="actions">
          <button class="btn btnPrimary" id="build">준비 설계하기</button>
          <button class="btn" id="sample">샘플 채우기</button>
          <span class="tiny" id="status"></span>
        </div>

        <div class="footer">
          ⚠️ 정보는 참고용이며, 현지 규정/항공사/숙소 정책 등은 최종 확인이 필요합니다.
          (다음 버전: 간단 일정 초안 생성 기능 예정)
        </div>
      </div>

      <div class="card">
        <div class="sectionTitle">
          <h2 style="margin:0">Trip Plan</h2>
          <span class="badge" id="badge">대기 중</span>
        </div>

        <div class="result" id="result" style="margin-top:12px">
          <div class="block">
            <h3>안내</h3>
            <p class="tiny">왼쪽에 여행 정보를 입력하고 "준비 설계하기"를 눌러주세요.</p>
          </div>
        </div>

        <div class="actions" style="margin-top:12px">
          <button class="btn btnGhost hidden" id="copyText">텍스트로 복사</button>
          <button class="btn btnGhost hidden" id="copyJson">JSON 복사</button>
          <button class="btn btnGhost hidden" id="reset">초기화</button>
        </div>

        <div class="footer">
          개발 메모: 결과는 서버리스 함수 <span class="mono">/api/analyze</span>에서 생성됩니다.
        </div>
      </div>
    </div>
  </div>

<script>
(() => {
  const $ = (id) => document.getElementById(id);

  const state = {
    transports: new Set(),
    lastJson: null,
    lastText: null
  };

  const chips = Array.from(document.querySelectorAll('#transportChips .chip'));
  chips.forEach(ch => {
    ch.addEventListener('click', () => {
      const v = ch.dataset.value;
      if (state.transports.has(v)) {
        state.transports.delete(v);
        ch.dataset.on = "0";
      } else {
        state.transports.add(v);
        ch.dataset.on = "1";
      }
    });
  });

  $('sample').addEventListener('click', () => {
    $('destination').value = "오사카";
    $('tripType').value = "해외";
    $('nights').value = "3박4일";
    $('people').value = "2명";
    $('season').value = "6월(장마)";
    $('notes').value = "커플 여행, 새벽 비행, 유심/이심 필요, 렌트카는 안 함";
    // transport
    state.transports = new Set(["비행기", "버스/기타"]);
    chips.forEach(x => x.dataset.on = state.transports.has(x.dataset.value) ? "1" : "0");
  });

  $('reset').addEventListener('click', () => {
    $('destination').value = "";
    $('tripType').value = "국내";
    $('nights').value = "";
    $('startDate').value = "";
    $('people').value = "";
    $('season').value = "";
    $('notes').value = "";
    state.transports = new Set();
    chips.forEach(x => x.dataset.on = "0");
    state.lastJson = null;
    state.lastText = null;
    renderIdle();
  });

  $('copyJson').addEventListener('click', async () => {
    if (!state.lastJson) return;
    await navigator.clipboard.writeText(JSON.stringify(state.lastJson, null, 2));
    setStatus("JSON을 복사했어요.");
    setTimeout(() => setStatus(""), 1400);
  });

  $('copyText').addEventListener('click', async () => {
    if (!state.lastText) return;
    await navigator.clipboard.writeText(state.lastText);
    setStatus("텍스트를 복사했어요.");
    setTimeout(() => setStatus(""), 1400);
  });

  function setBadge(text, tone="ok"){
    const b = $('badge');
    b.textContent = text;
    b.classList.remove('warn','ok');
    b.classList.add(tone);
  }
  function setStatus(text){ $('status').textContent = text; }

  function renderIdle(){
    setBadge("대기 중", "ok");
    $('result').innerHTML = `
      <div class="block">
        <h3>안내</h3>
        <p class="tiny">왼쪽에 여행 정보를 입력하고 "준비 설계하기"를 눌러주세요.</p>
      </div>
    `;
    $('copyJson').classList.add('hidden');
    $('copyText').classList.add('hidden');
    $('reset').classList.add('hidden');
  }

  function escapeHtml(s){
    return String(s ?? "")
      .replaceAll("&","&amp;")
      .replaceAll("<","&lt;")
      .replaceAll(">","&gt;")
      .replaceAll('"',"&quot;")
      .replaceAll("'","&#039;");
  }

  function list(items){
    if (!items || !items.length) return `<p class="tiny">-</p>`;
    return `<ul class="list">${items.map(x => `<li>${escapeHtml(x)}</li>`).join("")}</ul>`;
  }

  function scoreCard(label, value){
    return `
      <div class="scoreCard">
        <div class="scoreLabel">${label}</div>
        <div class="scoreVal">${escapeHtml(value)}</div>
      </div>
    `;
  }

  function buildCopyText(data){
    const lines = [];
    lines.push(`TripReady · 여행 준비 설계`);
    lines.push(`- 여행지: ${data.trip?.destination ?? ""} (${data.trip?.trip_type ?? ""})`);
    lines.push(`- 기간: ${data.trip?.duration ?? ""}`);
    if (data.trip?.start_date) lines.push(`- 출발일: ${data.trip.start_date}`);
    if (data.trip?.people) lines.push(`- 인원: ${data.trip.people}`);
    if (data.trip?.season) lines.push(`- 시기: ${data.trip.season}`);
    if (data.trip?.transport?.length) lines.push(`- 교통: ${data.trip.transport.join(", ")}`);
    lines.push("");
    lines.push(`[해야 할 일 타임라인]`);
    const tl = data.timeline || {};
    const keys = Object.keys(tl);
    keys.forEach(k => {
      lines.push(`- ${k}`);
      (tl[k] || []).forEach(it => lines.push(`  • ${it}`));
    });
    lines.push("");
    lines.push(`[준비물 체크리스트]`);
    const cl = data.checklist || {};
    Object.keys(cl).forEach(cat => {
      lines.push(`- ${cat}`);
      (cl[cat] || []).forEach(it => lines.push(`  • ${it}`));
    });
    lines.push("");
    lines.push(`[놓치기 쉬운 것]`);
    (data.common_misses || []).forEach(it => lines.push(`- ${it}`));
    lines.push("");
    lines.push(data.disclaimer || "참고용 설계이며, 현지/항공사/숙소 정책은 최종 확인이 필요합니다.");
    return lines.join("\n");
  }

  function renderResult(data){
    // copy text
    state.lastText = buildCopyText(data);

    const tl = data.timeline || {};
    const cl = data.checklist || {};

    $('result').innerHTML = `
      <div class="block">
        <h3>한 줄 요약 <span class="tiny">따뜻하지만 현실적으로</span></h3>
        <p>${escapeHtml(data.summary || "")}</p>
      </div>

      <div class="cols">
        <div class="block">
          <h3>해야 할 일 타임라인</h3>
          ${Object.keys(tl).length ? Object.keys(tl).map(k => `
            <div style="margin-top:10px">
              <div class="tiny" style="margin-bottom:6px;color:#cfe0ff">${escapeHtml(k)}</div>
              ${list(tl[k])}
            </div>
          `).join("") : `<p class="tiny">출발일이 없으면 일반 타임라인으로 구성돼요.</p>`}
        </div>

        <div class="block">
          <h3>놓치기 쉬운 것</h3>
          ${list(data.common_misses || [])}
        </div>
      </div>

      <div class="block">
        <h3>준비물 체크리스트</h3>
        ${Object.keys(cl).length ? Object.keys(cl).map(cat => `
          <div style="margin-top:10px">
            <div class="tiny" style="margin-bottom:6px;color:#cfe0ff">${escapeHtml(cat)}</div>
            ${list(cl[cat])}
          </div>
        `).join("") : `<p class="tiny">체크리스트를 생성하지 못했어요. 입력을 조금 더 구체적으로 해주세요.</p>`}
      </div>

      <div class="divider"></div>

      <div class="scoreRow">
        ${scoreCard("준비 난이도", `${data.scores?.prep_complexity ?? "-"} / 10`)}
        ${scoreCard("리스크 주의도", `${data.scores?.risk_level ?? "-"} / 10`)}
        ${scoreCard("빠뜨림 가능성", `${data.scores?.forget_risk ?? "-"} / 10`)}
        ${scoreCard("추천 준비 시작", data.scores?.start_now ?? "-")}
      </div>

      <div class="footer">${escapeHtml(data.disclaimer || "")}</div>
    `;

    $('copyJson').classList.remove('hidden');
    $('copyText').classList.remove('hidden');
    $('reset').classList.remove('hidden');
    setBadge("설계 완료", "ok");
  }

  $('build').addEventListener('click', async () => {
    const destination = $('destination').value.trim();
    const tripType = $('tripType').value;
    const duration = $('nights').value.trim();
    const startDate = $('startDate').value; // ISO yyyy-mm-dd or ""
    const people = $('people').value.trim();
    const season = $('season').value.trim();
    const notes = $('notes').value.trim();
    const transport = Array.from(state.transports);

    if (!destination || !duration) {
      setBadge("입력이 필요해요", "warn");
      setStatus("여행지와 기간은 꼭 입력해주세요.");
      return;
    }

    setBadge("설계 중…", "ok");
    setStatus("잠시만요…");

    const payload = {
      destination,
      tripType,
      duration,
      startDate: startDate || null,
      people: people || null,
      season: season || null,
      transport,
      notes: notes || null
    };

    try {
      const res = await fetch("/api/analyze", {
        method: "POST",
        headers: { "Content-Type":"application/json" },
        body: JSON.stringify(payload)
      });

      const text = await res.text();
      if (!res.ok) throw new Error(text || ("HTTP " + res.status));

      const data = JSON.parse(text);
      state.lastJson = data;
      renderResult(data);
      setStatus("");
    } catch (err) {
      console.error(err);
      setBadge("에러", "warn");
      $('result').innerHTML = `
        <div class="block">
          <h3>오류가 발생했어요</h3>
          <p class="tiny">/api/analyze 설정 또는 API 키를 확인해주세요.</p>
          <p class="tiny mono">${escapeHtml(err?.message || String(err))}</p>
        </div>
      `;
      setStatus("");
    }
  });

  renderIdle();
})();
</script>
</body>
</html>
